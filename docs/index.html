<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <title>åº—èˆ—æ¡ˆå†…ã‚·ã‚¹ãƒ†ãƒ </title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="css/Proc_style.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
</head>
<body>
  <header>
    <link rel="stylesheet" href="css/Proc_style.css">
    <h1 class="site-title"></h1>
    <button id="menu-toggle" class="hamburger">â˜°</button>
    <nav id="sidebar" class="sidebar">
     <ul>
      <li><a href="itirann.html">å•†å“ä¸€è¦§</a></li>
      <li><a href="#">ãƒ¡ãƒ‹ãƒ¥ãƒ¼2</a></li>
      <li><a href="#">ãƒ¡ãƒ‹ãƒ¥ãƒ¼3</a></li>
     </ul>
    </nav>

    <button onclick="showContent()" id="show-search-button">ğŸ”</button>
  <div id="search-panel">
    <div id="hidden-content">
      <label for="search"></label>
      <input type="text" id="search" name="q" placeholder="ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›">
      <button type="button" onclick="showbackContent()" id="show-back-button">Ã—</button>
    </div>
    <div id="search-results" class="container mt-4 row"></div>
  </div>
  

  </header>




  <main>
      <link rel="stylesheet" href="css/Proc_style.css">
      <img id="img" src="picture/map_open.png" alt="ç”»åƒ1">
  </main>


<script src="docs/kuromoji.js-master/kuromoji.js-master/build/kuromoji.js"></script>




  <script>
    ///ä»¥ä¸‹æ¤œç´¢é …ç›®ã®è¡¨ç¤ºéè¡¨ç¤ºã®åˆ‡ã‚Šæ›¿ãˆ

    //æ¤œç´¢ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ãŸæ™‚ã€æ¤œç´¢é …ç›®ã¨æˆ»ã‚‹ãƒœã‚¿ãƒ³ã®è¡¨ç¤ºãƒ»å…ƒã€…ã‚ã£ãŸæ¤œç´¢ãƒœã‚¿ãƒ³ã®éè¡¨ç¤º
    function showContent() {
      document.getElementById('hidden-content').style.display = 'flex';
      document.getElementById('show-search-button').style.display = 'none';
      document.getElementById('show-back-button').style.display = 'block';
      document.getElementById('search-panel').classList.add('active');
      document.getElementById('search').focus();
      const showButton = document.getElementById('show-search-button');
    }
    //æˆ»ã‚‹ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ãŸæ™‚ã€æ¤œç´¢é …ç›®ã¨æˆ»ã‚‹ãƒœã‚¿ãƒ³ã®éè¡¨ç¤ºãƒ»å…ƒã€…ã‚ã£ãŸæ¤œç´¢ãƒœã‚¿ãƒ³ã®è¡¨ç¤º
    function showbackContent() {
      document.getElementById('hidden-content').style.display = 'none';
      document.getElementById('show-search-button').style.display = 'block';
      document.getElementById('show-back-button').style.display = 'none';
      document.getElementById('search-panel').classList.remove('active');
      document.getElementById('search-results').innerHTML = "";
      document.getElementById('search').value = "";

      const showButton = document.getElementById('show-back-button');
    }
      document.getElementById('menu-toggle').addEventListener('click', function () {
        const sidebar = document.getElementById('sidebar');
        const toggleButton = document.getElementById('menu-toggle');

        sidebar.classList.toggle('active');
        toggleButton.classList.toggle('no-border');
      });
  </script>

<!-- Firebaseäº’æ›ç‰ˆã®èª­ã¿è¾¼ã¿ -->
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

<script>
  // Firebaseè¨­å®š
  const firebaseConfig = {
    apiKey: "AIzaSyAHiMCeiOFN-R4EoLTiBpeJWIUQYIrUA5M",
    authDomain: "beacon-haptic-sim.firebaseapp.com",
    projectId: "beacon-haptic-sim",
    storageBucket: "beacon-haptic-sim.appspot.com",
    messagingSenderId: "699174750938",
    appId: "1:699174750938:web:1ade40d8ef1a30c9c0b3e3",
    measurementId: "G-4QX9T79SL7"
  };

  // FirebaseåˆæœŸåŒ–
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  // ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡é˜²æ­¢ï¼ˆä¸è¦ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒï¼‰
  document.getElementById('hidden-content').addEventListener('submit', (event) => {
    event.preventDefault();
  });

  // kuromojiãƒˆãƒ¼ã‚¯ãƒŠã‚¤ã‚¶ãƒ¼ã‚’ç”¨æ„
  kuromoji.builder({ dicPath: "/url/to/dictionary/dir/" }).build(function (err, tokenizer) {
    // tokenizer is ready
    var path = tokenizer.tokenize("ã™ã‚‚ã‚‚ã‚‚ã‚‚ã‚‚ã‚‚ã‚‚ã‚‚ã®ã†ã¡");
    console.log(path);
  });

  // ãƒ‡ãƒã‚¦ãƒ³ã‚¹ç”¨ã‚¿ã‚¤ãƒãƒ¼
  let debounceTimer;

  document.getElementById('search').addEventListener('input', function(event) {
    const keyword = event.target.value.trim();

    clearTimeout(debounceTimer);

    debounceTimer = setTimeout(() => {
      if(keyword === "") {
        document.getElementById('search-results').innerHTML = "";
        return;
      }

      if(!tokenizer) {
        // tokenizerãŒã¾ã æº–å‚™ã§ãã¦ãªã‘ã‚Œã°å‡¦ç†ã—ãªã„
        return;
      }

      // kuromojiã§å½¢æ…‹ç´ è§£æ
      const tokens = tokenizer.tokenize(keyword);
      const words = tokens.map(token => token.surface_form.toLowerCase());

      searchItems(words);
    }, 300);
  });

  async function searchItems(words) {
    const resultsContainer = document.getElementById('search-results');
    resultsContainer.innerHTML = "";

    const snapshot = await db.collection("products").get();

    let found = 0;
    snapshot.forEach(doc => {
      const data = doc.data();

      // æ¤œç´¢å¯¾è±¡ãƒ†ã‚­ã‚¹ãƒˆã‚’çµåˆã—å°æ–‡å­—åŒ–
      const text = `${data.name || ""} ${data.category || ""} ${data.detail || ""} ${(data.tags || []).join(" ")}`.toLowerCase();

      // words ã®ã™ã¹ã¦ã®å˜èªãŒå«ã¾ã‚Œã‚‹ã‹
      const matched = words.every(w => text.includes(w));

      if(matched) {
        found++;
        resultsContainer.innerHTML += `
          <div class="search-item">
            <a href="detail.html?id=${doc.id}" style="text-decoration:none; color:inherit;">
              <h5 class="item-name">${data.name}</h5>
              <p class="item-category">${data.category}</p>
            </a>
          </div>
        `;
      }
    });

    if(found === 0) {
      resultsContainer.innerHTML = `<p>è©²å½“ã™ã‚‹å•†å“ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</p>`;
    }
  }
</script>


</body>
</html>
