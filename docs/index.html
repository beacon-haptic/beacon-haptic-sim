<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <title>店舗案内システム</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="css/Proc_style.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
</head>
<body>
  <header>
    <link rel="stylesheet" href="css/Proc_style.css">
    <h1 class="site-title"></h1>
    <button id="menu-toggle" class="hamburger">☰</button>
    <nav id="sidebar" class="sidebar">
     <ul>
      <li><a href="itirann.html">商品一覧</a></li>
      <li><a href="#">メニュー2</a></li>
      <li><a href="#">メニュー3</a></li>
     </ul>
    </nav>
    <form id="hidden-content">
      <label for="search"></label>
      <input type="text" id="search" name="q" placeholder="キーワードを入力">
      <button onclick="showbackContent()" id="show-back-button">×</button>
    </form>
    <button onclick="showContent()" id="show-search-button">🔍</button>

  </header>

  <main>
      <link rel="stylesheet" href="css/Proc_style.css">
      <img id="img" src="picture/map_open.png" alt="画像1">
  </main>


  <script>
    ///以下検索項目の表示非表示の切り替え

    //検索ボタンを押した時、検索項目と戻るボタンの表示・元々あった検索ボタンの非表示
    function showContent() {
      document.getElementById('hidden-content').style.display = 'flex';
      document.getElementById('show-search-button').style.display = 'none';
      document.getElementById('show-back-button').style.display = 'block';
      const showButton = document.getElementById('show-search-button');
    }
    //戻るボタンを押した時、検索項目と戻るボタンの非表示・元々あった検索ボタンの表示
    function showbackContent() {
      document.getElementById('hidden-content').style.display = 'none';
      document.getElementById('show-search-button').style.display = 'block';
      document.getElementById('show-back-button').style.display = 'none';
      const showButton = document.getElementById('show-back-button');
    }
      document.getElementById('menu-toggle').addEventListener('click', function () {
        const sidebar = document.getElementById('sidebar');
        const toggleButton = document.getElementById('menu-toggle');

        sidebar.classList.toggle('active');
        toggleButton.classList.toggle('no-border');
      });
  </script>

  <script type="module">
  import { initializeApp, getApps, getApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
  import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

  // Firebase設定
  const firebaseConfig = {
    apiKey: "AIzaSyAHiMCeiOFN-R4EoLTiBpeJWIUQYIrUA5M",
    authDomain: "beacon-haptic-sim.firebaseapp.com",
    projectId: "beacon-haptic-sim",
    storageBucket: "beacon-haptic-sim.appspot.com",
    messagingSenderId: "699174750938",
    appId: "1:699174750938:web:1ade40d8ef1a30c9c0b3e3",
    measurementId: "G-4QX9T79SL7"
  };

  // Firebase 初期化
  const app = getApps().length ? getApp() : initializeApp(firebaseConfig);
  const db = getFirestore(app);
  document.getElementById('hidden-content').addEventListener('submit', (event) => {
  event.preventDefault();  // フォーム送信を阻止
});


  // 🔍 検索実行イベント
  document.getElementById('search').addEventListener('keydown', async (event) => {
    if (event.key === 'Enter') {
      event.preventDefault();  // フォーム送信防止
      const keyword = event.target.value.trim();
      if (keyword !== "") {
        await searchItems(keyword);
      }
    }
  });

  // 🔍 検索ロジック
  async function searchItems(keyword) {
    const resultsContainer = document.getElementById('search-results');
    resultsContainer.innerHTML = ""; // クリア

    const snapshot = await getDocs(collection(db, "products"));
    let found = 0;

    snapshot.forEach(doc => {
      const data = doc.data();
      const { name, category, detail, tag, image } = data;

      const keywordLower = keyword.toLowerCase();

      // 条件：部分一致 or タグ一致
      const matches =
        (name && name.includes(keyword)) ||
        (category && category.includes(keyword)) ||
        (detail && detail.includes(keyword)) ||
        (Array.isArray(tag) && tag.some(t => t.includes(keyword)));

      if (matches) {
        found++;

        // HTMLカード生成
        const itemHTML = `
          <div class="search-item">
            <div class="search-info">
              <h5 class="item-name">${name}</h5>
              <p class="item-category">${category}</p>
            </div>
          </div>
        `;
        resultsContainer.innerHTML += itemHTML;
      }
    });

    if (found === 0) {
      resultsContainer.innerHTML = `<p>該当する商品が見つかりませんでした。</p>`;
    }
  }

</script>

</body>
</html>
