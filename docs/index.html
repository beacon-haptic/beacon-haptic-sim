<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

  <title>ãƒ­ã‚°ã‚¤ãƒ³ / æ–°è¦ç™»éŒ²</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="css/Proc_login_style.css">
</head>
<body class="p-4">

  <div class="login-card">
    <h1 class="app-title">åº—èˆ—æ¡ˆå†…ã‚·ã‚¹ãƒ†ãƒ </h1> 
    <h3 class="text-center mb-3">ãƒ­ã‚°ã‚¤ãƒ³ / æ–°è¦ç™»éŒ²</h3>

    <div class="mb-3">
      <input type="email" id="email" class="form-control" placeholder="ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹">
    </div>

    <div class="mb-3 position-relative">
      <input type="password" id="password" class="form-control" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰">
      <span id="toggle-password" class="toggle-icon">ğŸ‘â€ğŸ—¨</span>
    </div>

    <!-- ãƒ­ã‚°ã‚¤ãƒ³ç”¨ -->
    <div id="login-error" class="text-danger mb-3" style="display:none;"></div>

    <!-- æ–°è¦ç™»éŒ²ç”¨ -->
    <div id="signup-error" class="text-danger mb-3" style="display:none;"></div>

    <button id="login-btn" class="btn w-100 mt-2">ãƒ­ã‚°ã‚¤ãƒ³</button>
    <button id="signup-btn" class="btn w-100 mt-2" style="background:#6ca8ff;">æ–°è¦ç™»éŒ²</button>
    <button id="guest-btn" class="btn w-100 mt-3" style="background:#8e8e8e; color:white;">
      ã‚²ã‚¹ãƒˆã¨ã—ã¦å…¥å®¤
    </button>


  </div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAiHMCeiOFN-R4EoLTiBpeJWlUQYIrUA5M",
      authDomain: "beacon-haptic-sim.firebaseapp.com",
      projectId: "beacon-haptic-sim",
      storageBucket: "beacon-haptic-sim.appspot.com",
      messagingSenderId: "699174750938",
      appId: "1:699174750938:web:1ade40d8ef1a30c9c0b3e3",
      measurementId: "G-4QX9T79SL7"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();

    const loginError = document.getElementById("login-error");
    const signupError = document.getElementById("signup-error");

    // ğŸ”¹ ã‚¨ãƒ©ãƒ¼ã‚’éš ã™é–¢æ•°
    function clearErrors() {
      loginError.style.display = "none";
      signupError.style.display = "none";
      loginError.textContent = "";
      signupError.textContent = "";
    }

    // ğŸ”¹ ãƒ­ã‚°ã‚¤ãƒ³
    document.getElementById('login-btn').addEventListener('click', async () => {
      clearErrors();

      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;

      try {
        await auth.signInWithEmailAndPassword(email, password);
        location.href = "main.html";
      } catch (e) {
        loginError.style.display = "block";
        loginError.textContent = "ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã€ã‚‚ã—ãã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã«èª¤ã‚ŠãŒã‚ã‚Šã¾ã™";
      }
    });

    // ğŸ”¹ æ–°è¦ç™»éŒ²
    document.getElementById('signup-btn').addEventListener('click', async () => {
      clearErrors();

      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;

      try {
        await auth.createUserWithEmailAndPassword(email, password);
        alert("ç™»éŒ²æˆåŠŸï¼");
        location.href = "main.html";
      } catch (e) {

        if (e.code === "auth/email-already-in-use") {
          signupError.style.display = "block";
          signupError.textContent = "æ—¢ã«ã“ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯ä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™";
        } else {
          signupError.style.display = "block";
          signupError.textContent = "ç™»éŒ²ã«å¤±æ•—ã—ã¾ã—ãŸ";
        }
      }
    });

    // ğŸ”¹ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰è¡¨ç¤ºåˆ‡æ›¿
    const passwordInput = document.getElementById("password");
    const togglePassword = document.getElementById("toggle-password");

    togglePassword.addEventListener("click", () => {
      const isHidden = passwordInput.type === "password";
      passwordInput.type = isHidden ? "text" : "password";
      togglePassword.textContent = isHidden ? "ğŸ‘â€ğŸ—¨" : "ãƒ¼";
    });

  </script>

  <script>
    document.getElementById('guest-btn').addEventListener('click', async () => {
      clearErrors();

      try {
        await auth.signInAnonymously();  // â† Firebase Anonymous Auth
        location.href = "main.html";     // ãƒ­ã‚°ã‚¤ãƒ³å¾Œã®ç”»é¢ã¸
      } catch (e) {
        alert("ã‚²ã‚¹ãƒˆå…¥å®¤ã«å¤±æ•—ã—ã¾ã—ãŸ: " + e.message);
      }
    });
  </script>

</body>
</html>
